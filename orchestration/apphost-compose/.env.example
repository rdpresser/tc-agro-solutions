# =====================================================
# TC Agro Solutions - Environment Configuration Template
# =====================================================
# 
# ðŸ“ INSTRUCTIONS:
# 1. Copy this file to `.env` (NOT TRACKED IN GIT)
# 2. Update values for your environment
# 3. DO NOT commit `.env` to Git (already in .gitignore)
# 4. Each developer creates their own `.env`
# 5. âš ï¸ PRODUCTION values are marked with âš ï¸ - CHANGE IMMEDIATELY
#
# ðŸ”— HIERARCHY PATTERN (for .NET IOptions):
#    appsettings.json: "Section": { "SubSection": { "Key": "value" } }
#    .env variable:     Section__SubSection__Key=value
#
# =====================================================

# =====================================================
# CORE ENVIRONMENT
# =====================================================
# Controls ASP.NET Core runtime and build configuration

ASPNETCORE_ENVIRONMENT=Development
ASPNETCORE_URLS=http://0.0.0.0:8080
BUILD_CONFIGURATION=Debug

# =====================================================
# INFRASTRUCTURE - PostgreSQL (simple names for Docker)
# =====================================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=tc-agro-identity-db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_SCHEMA=public
POSTGRES_MAINTENANCE_DB=postgres
POSTGRES_INIT_ARGS=-c log_statement=all -c log_duration=on

# Connection pool tuning
POSTGRES_CONNECTION_TIMEOUT=30
POSTGRES_MIN_POOL_SIZE=2
POSTGRES_MAX_POOL_SIZE=20

# =====================================================
# INFRASTRUCTURE - Redis (simple names for Docker)
# =====================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# =====================================================
# INFRASTRUCTURE - RabbitMQ (simple names for Docker)
# =====================================================
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_PORT=15672
RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASSWORD=guest
RABBITMQ_DEFAULT_VHOST=/
RABBITMQ_VM_MEMORY_HIGH_WATERMARK=512MB

# =====================================================
# INFRASTRUCTURE - OBSERVABILITY
# =====================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_PORT=3000

PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION=15d
PROMETHEUS_CONFIG_FILE=prometheus.yml
# To disable Identity monitoring, use this alternative config file or stop container in docker desktop to avoid duplicate scrape targets on /metrics
# PROMETHEUS_CONFIG_FILE=prometheus.no-identity.yml

LOKI_PORT=3100
TEMPO_PORT=3200
OTEL_COLLECTOR_PORT=4317
OTEL_COLLECTOR_HTTP_PORT=4318

# =====================================================
# Hierarchy: Database > Postgres > Key
# Maps to appsettings.json: "Database": { "Postgres": { ... } }
Database__Postgres__Host=${POSTGRES_HOST}
Database__Postgres__Port=${POSTGRES_PORT}
Database__Postgres__Database=${POSTGRES_DB}
Database__Postgres__UserName=${POSTGRES_USER}
Database__Postgres__Password=${POSTGRES_PASSWORD}
Database__Postgres__Schema=${POSTGRES_SCHEMA}
Database__Postgres__MaintenanceDatabase=${POSTGRES_MAINTENANCE_DB}
Database__Postgres__ConnectionTimeout=${POSTGRES_CONNECTION_TIMEOUT}
Database__Postgres__MinPoolSize=${POSTGRES_MIN_POOL_SIZE}
Database__Postgres__MaxPoolSize=${POSTGRES_MAX_POOL_SIZE}

# =====================================================
# .NET APPLICATION - CACHE (Cache.Redis.*)
# =====================================================
# Hierarchy: Cache > Redis > Key
# Maps to appsettings.json: "Cache": { "Redis": { ... } }
Cache__Redis__Host=${REDIS_HOST}
Cache__Redis__Port=${REDIS_PORT}
Cache__Redis__Password=${REDIS_PASSWORD}
Cache__Redis__DefaultTTL=300

# =====================================================
# .NET APPLICATION - MESSAGING (Messaging.RabbitMQ.*)
# =====================================================
# Hierarchy: Messaging > RabbitMQ > Key
# Maps to appsettings.json: "Messaging": { "RabbitMQ": { ... } }
Messaging__RabbitMQ__Host=${RABBITMQ_HOST}
Messaging__RabbitMQ__Port=${RABBITMQ_PORT}
Messaging__RabbitMQ__ManagementPort=${RABBITMQ_MANAGEMENT_PORT}
Messaging__RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
Messaging__RabbitMQ__Exchange=identity.events
Messaging__RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
Messaging__RabbitMQ__Password=${RABBITMQ_DEFAULT_PASSWORD}
Messaging__RabbitMQ__AutoProvision=true
Messaging__RabbitMQ__Durable=true
Messaging__RabbitMQ__UseQuorumQueues=false
Messaging__RabbitMQ__AutoPurgeOnStartup=false

# =====================================================
# .NET APPLICATION - TELEMETRY (Telemetry.Grafana.*)
# =====================================================
# Hierarchy: Telemetry > Grafana > Agent/Otlp > Key
# Maps to appsettings.json: "Telemetry": { "Grafana": { ... } }
# 
# IMPORTANTE: Esta configuraÃ§Ã£o Ã© para aplicaÃ§Ãµes DENTRO do Docker Compose!
# Para rodar com "dotnet run" no host, use localhost em vez de otel-collector
# =====================================================

# Simple vars (for Docker Compose readability)
TELEMETRY_GRAFANA_AGENT_HOST=otel-collector
TELEMETRY_GRAFANA_AGENT_OTLP_GRPC_PORT=4317
TELEMETRY_GRAFANA_AGENT_OTLP_HTTP_PORT=4318
TELEMETRY_GRAFANA_AGENT_METRICS_PORT=12345
TELEMETRY_GRAFANA_AGENT_ENABLED=true
# =====================================================
# ESTRATÃ‰GIA DAEMONSET (January 31, 2026)
# =====================================================
# Antigo (Docker Compose direto): Apps Docker â†’ OTEL Collector Docker
# TELEMETRY_GRAFANA_OTLP_ENDPOINT=http://otel-collector:4318
#
# Novo (DaemonSet k3d): Apps k3d â†’ DaemonSet Agent â†’ OTEL Collector Docker
# - Apps em k3d usam DNS Kubernetes: otel-collector.observability:4318
# - DaemonSet envia para Docker via host.k3d.internal:14318
# =====================================================
TELEMETRY_GRAFANA_OTLP_ENDPOINT=http://otel-collector.observability:4318
TELEMETRY_GRAFANA_OTLP_PROTOCOL=http/protobuf
TELEMETRY_GRAFANA_OTLP_TIMEOUT_SECONDS=10
TELEMETRY_GRAFANA_OTLP_INSECURE=true

# Hierarchical vars (for .NET IOptions binding)
Telemetry__Grafana__Agent__Host=${TELEMETRY_GRAFANA_AGENT_HOST}
Telemetry__Grafana__Agent__OtlpGrpcPort=${TELEMETRY_GRAFANA_AGENT_OTLP_GRPC_PORT}
Telemetry__Grafana__Agent__OtlpHttpPort=${TELEMETRY_GRAFANA_AGENT_OTLP_HTTP_PORT}
Telemetry__Grafana__Agent__MetricsPort=${TELEMETRY_GRAFANA_AGENT_METRICS_PORT}
Telemetry__Grafana__Agent__Enabled=${TELEMETRY_GRAFANA_AGENT_ENABLED}
Telemetry__Grafana__Otlp__Endpoint=${TELEMETRY_GRAFANA_OTLP_ENDPOINT}
Telemetry__Grafana__Otlp__Protocol=${TELEMETRY_GRAFANA_OTLP_PROTOCOL}
Telemetry__Grafana__Otlp__TimeoutSeconds=${TELEMETRY_GRAFANA_OTLP_TIMEOUT_SECONDS}
Telemetry__Grafana__Otlp__Insecure=${TELEMETRY_GRAFANA_OTLP_INSECURE}

# =====================================================
# .NET APPLICATION - SERVICES (Services.{Service}.*)
# =====================================================
# See section above for Telemetry__Grafana__* variables
# (defined above in "TELEMETRY (Telemetry.Grafana.*)" section)ping
#    - Test RabbitMQ: curl http://localhost:15672/api/overview
#
# 5. Variable format reference:
#    - Simple value: VARIABLE_NAME=value
#    - Connection strings: Host=...;Port=...;Username=...
#    - Hierarchical (.NET): Section__SubSection__Key=value
#    - Boolean: true/false (case-insensitive)
#    - Numeric: no quotes (5432, 256, etc.)
#    - Strings: no quotes needed unless containing spaces
#
# =====================================================
