# =====================================================
# TC Agro Solutions - Environment Configuration Template
# =====================================================
# 
# ðŸ“ INSTRUCTIONS:
# 1. Copy this file to `.env` (NOT TRACKED IN GIT)
# 2. Update values for your environment
# 3. DO NOT commit `.env` to Git (already in .gitignore)
# 4. Each developer creates their own `.env`
# 5. âš ï¸ PRODUCTION values are marked with âš ï¸ - CHANGE IMMEDIATELY
#
# ðŸ”— HIERARCHY PATTERN (for .NET IOptions):
#    appsettings.json: "Section": { "SubSection": { "Key": "value" } }
#    .env variable:     Section__SubSection__Key=value
#
# =====================================================

# =====================================================
# CORE ENVIRONMENT
# =====================================================
# Controls ASP.NET Core runtime and build configuration

ASPNETCORE_ENVIRONMENT=Development
ASPNETCORE_URLS=http://0.0.0.0:8080
BUILD_CONFIGURATION=Debug

# Docker Registry (for pulling images from Docker Hub)
DOCKER_REGISTRY=rdpresser/

# =====================================================
# INFRASTRUCTURE - PostgreSQL (simple names for Docker)
# =====================================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=tc-agro-identity-db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_SCHEMA=public
POSTGRES_MAINTENANCE_DB=postgres
POSTGRES_INIT_ARGS=-c log_statement=all -c log_duration=on

# Connection pool tuning
POSTGRES_CONNECTION_TIMEOUT=30
POSTGRES_MIN_POOL_SIZE=2
POSTGRES_MAX_POOL_SIZE=20

# =====================================================
# INFRASTRUCTURE - Redis (simple names for Docker)
# =====================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# =====================================================
# INFRASTRUCTURE - RabbitMQ (simple names for Docker)
# =====================================================
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_PORT=15672
RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASSWORD=guest
RABBITMQ_DEFAULT_VHOST=/
RABBITMQ_VM_MEMORY_HIGH_WATERMARK=512MB

# =====================================================
# INFRASTRUCTURE - OBSERVABILITY
# =====================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_PORT=3000

PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION=15d
PROMETHEUS_CONFIG_FILE=prometheus.yml
# To disable Identity monitoring, use this alternative config file or stop container in docker desktop to avoid duplicate scrape targets on /metrics
# PROMETHEUS_CONFIG_FILE=prometheus.no-identity.yml

LOKI_PORT=3100
TEMPO_PORT=3200
OTEL_COLLECTOR_PORT=4317
OTEL_COLLECTOR_HTTP_PORT=4318

# =====================================================
# Hierarchy: Database > Postgres > Key
# Maps to appsettings.json: "Database": { "Postgres": { ... } }
Database__Postgres__Host=${POSTGRES_HOST}
Database__Postgres__Port=${POSTGRES_PORT}
Database__Postgres__Database=${POSTGRES_DB}
Database__Postgres__UserName=${POSTGRES_USER}
Database__Postgres__Password=${POSTGRES_PASSWORD}
Database__Postgres__Schema=${POSTGRES_SCHEMA}
Database__Postgres__MaintenanceDatabase=${POSTGRES_MAINTENANCE_DB}
Database__Postgres__ConnectionTimeout=${POSTGRES_CONNECTION_TIMEOUT}
Database__Postgres__MinPoolSize=${POSTGRES_MIN_POOL_SIZE}
Database__Postgres__MaxPoolSize=${POSTGRES_MAX_POOL_SIZE}

# .NET Connection String (built from above variables)
# This is a convenience variable, apps can build it from individual values
ConnectionStrings__DefaultConnection=Host=${POSTGRES_HOST};Port=${POSTGRES_PORT};Database=${POSTGRES_DB};Username=${POSTGRES_USER};Password=${POSTGRES_PASSWORD};Include Error Detail=true

# =====================================================
# .NET APPLICATION - CACHE (Cache.Redis.*)
# =====================================================
# Hierarchy: Cache > Redis > Key
# Maps to appsettings.json: "Cache": { "Redis": { ... } }
Cache__Redis__Host=${REDIS_HOST}
Cache__Redis__Port=${REDIS_PORT}
Cache__Redis__Password=${REDIS_PASSWORD}
Cache__Redis__DefaultTTL=300

# =====================================================
# .NET APPLICATION - MESSAGING (Messaging.RabbitMQ.*)
# =====================================================
# Hierarchy: Messaging > RabbitMQ > Key
# Maps to appsettings.json: "Messaging": { "RabbitMQ": { ... } }
Messaging__RabbitMQ__Host=${RABBITMQ_HOST}
Messaging__RabbitMQ__Port=${RABBITMQ_PORT}
Messaging__RabbitMQ__ManagementPort=${RABBITMQ_MANAGEMENT_PORT}
Messaging__RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
Messaging__RabbitMQ__Exchange=identity.events
Messaging__RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
Messaging__RabbitMQ__Password=${RABBITMQ_DEFAULT_PASSWORD}
Messaging__RabbitMQ__AutoProvision=true
Messaging__RabbitMQ__Durable=true
Messaging__RabbitMQ__UseQuorumQueues=false
Messaging__RabbitMQ__AutoPurgeOnStartup=false

# =====================================================
# .NET APPLICATION - TELEMETRY (Telemetry.Grafana.*)
# =====================================================
# Hierarchy: Telemetry > Grafana > Agent/Otlp > Key
# Maps to appsettings.json: "Telemetry": { "Grafana": { ... } }
# 
# IMPORTANTE: Esta configuraÃ§Ã£o Ã© para aplicaÃ§Ãµes DENTRO do Docker Compose!
# Para rodar com "dotnet run" no host, use localhost em vez de otel-collector
#
# NOTA: Endpoint vs LogsEndpoint
#   - Endpoint (sem path): OpenTelemetry SDK adiciona automaticamente /v1/traces, /v1/metrics
#   - LogsEndpoint (com /v1/logs): Serilog.Sinks.OpenTelemetry requer path completo
# =====================================================

# Simple vars (for Docker Compose readability)
TELEMETRY_GRAFANA_AGENT_HOST=otel-collector
TELEMETRY_GRAFANA_AGENT_OTLP_GRPC_PORT=4317
TELEMETRY_GRAFANA_AGENT_OTLP_HTTP_PORT=4318
TELEMETRY_GRAFANA_AGENT_METRICS_PORT=12345
TELEMETRY_GRAFANA_AGENT_ENABLED=true
# =====================================================
# ESTRATÃ‰GIA DE ENDPOINT POR AMBIENTE
# =====================================================
# Docker Compose (este arquivo .env): Apps Docker â†’ OTEL Collector Docker
#   - Endpoint: http://otel-collector:4318 (nome do container)
#
# k3d Cluster (configmap.yaml): Apps k3d â†’ DaemonSet Agent â†’ OTEL Collector Docker
#   - Endpoint: http://otel-collector-agent.observability.svc.cluster.local:4317
#   - DaemonSet encaminha para Docker via host.k3d.internal:14318
# =====================================================
TELEMETRY_GRAFANA_OTLP_ENDPOINT=http://otel-collector:4318
TELEMETRY_GRAFANA_OTLP_PROTOCOL=http/protobuf
TELEMETRY_GRAFANA_OTLP_TIMEOUT_SECONDS=10
TELEMETRY_GRAFANA_OTLP_INSECURE=true

# Hierarchical vars (for .NET IOptions binding)
Telemetry__Grafana__Agent__Host=${TELEMETRY_GRAFANA_AGENT_HOST}
Telemetry__Grafana__Agent__OtlpGrpcPort=${TELEMETRY_GRAFANA_AGENT_OTLP_GRPC_PORT}
Telemetry__Grafana__Agent__OtlpHttpPort=${TELEMETRY_GRAFANA_AGENT_OTLP_HTTP_PORT}
Telemetry__Grafana__Agent__MetricsPort=${TELEMETRY_GRAFANA_AGENT_METRICS_PORT}
Telemetry__Grafana__Agent__Enabled=${TELEMETRY_GRAFANA_AGENT_ENABLED}
Telemetry__Grafana__Otlp__Endpoint=${TELEMETRY_GRAFANA_OTLP_ENDPOINT}
Telemetry__Grafana__Otlp__Protocol=${TELEMETRY_GRAFANA_OTLP_PROTOCOL}
Telemetry__Grafana__Otlp__TimeoutSeconds=${TELEMETRY_GRAFANA_OTLP_TIMEOUT_SECONDS}
Telemetry__Grafana__Otlp__Insecure=${TELEMETRY_GRAFANA_OTLP_INSECURE}

# =====================================================
# .NET APPLICATION - SERVICES (Services.{Service}.*)
# =====================================================
# Hierarchy: Services > ServiceName > Key
# Maps to appsettings.json: "Services": { "Identity": { "HttpPort": ... } }
Services__Identity__HttpPort=5001
Services__Farm__HttpPort=5002
Services__SensorIngest__HttpPort=5003
Services__AnalyticsWorker__HttpPort=5004
Services__Dashboard__HttpPort=5005

# =====================================================
# .NET APPLICATION - JWT / AUTHENTICATION (Auth.Jwt.*)
# =====================================================
# Hierarchy: Auth > Jwt > Key
# Maps to appsettings.json: "Auth": { "Jwt": { ... } }
Auth__Jwt__Issuer=tc-agro-identity-service
Auth__Jwt__Audience__0=tc-agro-identity-service
Auth__Jwt__Audience__1=tc-agro-farm-service
Auth__Jwt__Audience__2=tc-agro-sensor-ingest-service
Auth__Jwt__Audience__3=tc-agro-analytics-worker
Auth__Jwt__Audience__4=tc-agro-dashboard-service
Auth__Jwt__SecretKey=your-your-256-bit-secret-key-change-in-production-12345678
Auth__Jwt__ExpirationInMinutes=480

# =====================================================
# .NET APPLICATION - LOGGING (Logging.LogLevel.*)
# =====================================================
# Hierarchy: Logging > LogLevel > Key
# Maps to appsettings.json: "Logging": { "LogLevel": { ... } }
# Note: Keys with dots are preserved in the name (e.g., Microsoft.AspNetCore)
Logging__LogLevel__Default=Information
Logging__LogLevel__Microsoft_AspNetCore=Warning
Logging__LogLevel__System=Warning

# =====================================================
# .NET APPLICATION - TELEMETRY (Telemetry.Grafana.*)
# =====================================================
# See section above for Telemetry__Grafana__* variables
# (defined above in "TELEMETRY (Telemetry.Grafana.*)" section)
