# =====================================================
# TC Agro Solutions - Environment Configuration Template
# =====================================================
# 
# üìù INSTRUCTIONS:
# 1. Copy this file to `.env` (NOT TRACKED IN GIT)
# 2. Update values for your environment
# 3. DO NOT commit `.env` to Git (already in .gitignore)
# 4. Each developer creates their own `.env`
# 5. ‚ö†Ô∏è PRODUCTION values are marked with ‚ö†Ô∏è - CHANGE IMMEDIATELY
#
# üîó HIERARCHY PATTERN (for .NET IOptions):
#    appsettings.json: "Section": { "SubSection": { "Key": "value" } }
#    .env variable:     Section__SubSection__Key=value
#
# =====================================================

# =====================================================
# CORE ENVIRONMENT
# =====================================================
# Controls ASP.NET Core runtime and build configuration

ASPNETCORE_ENVIRONMENT=Development
ASPNETCORE_URLS=http://0.0.0.0:8080
BUILD_CONFIGURATION=Debug

# =====================================================
# INFRASTRUCTURE - PostgreSQL
# =====================================================
# Database connection for all services
# TimescaleDB extension is auto-enabled on startup

POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=tc-agro-identity-db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_SCHEMA=public
POSTGRES_MAINTENANCE_DB=postgres
POSTGRES_INIT_ARGS=-c log_statement=all -c log_duration=on

# Connection pool tuning
POSTGRES_CONNECTION_TIMEOUT=30
POSTGRES_MIN_POOL_SIZE=2
POSTGRES_MAX_POOL_SIZE=20

# Composite connection string (built from above variables)
# Format: Host=...;Port=...;Database=...;Username=...;Password=...
ConnectionStrings__DefaultConnection=Host=postgres;Port=5432;Database=tc-agro-identity-db;Username=postgres;Password=postgres;Include Error Detail=true

# =====================================================
# INFRASTRUCTURE - Redis Cache
# =====================================================
# High-speed in-memory cache for session data, queries, etc.

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# .NET IOptions mapping
Cache__Redis__Host=redis
Cache__Redis__Port=6379
Cache__Redis__Password=
Cache__Redis__DefaultTTL=300

# =====================================================
# INFRASTRUCTURE - RabbitMQ Message Broker
# =====================================================
# Event streaming and inter-service communication
# Replaces Azure Service Bus in local environment

RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_PORT=15672
RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASSWORD=guest
RABBITMQ_DEFAULT_VHOST=/
RABBITMQ_VM_MEMORY_HIGH_WATERMARK=512MB

# .NET IOptions mapping
Messaging__RabbitMQ__Host=rabbitmq
Messaging__RabbitMQ__Port=5672
Messaging__RabbitMQ__ManagementPort=15672
Messaging__RabbitMQ__VirtualHost=/
Messaging__RabbitMQ__Exchange=identity.events
Messaging__RabbitMQ__UserName=guest
Messaging__RabbitMQ__Password=guest
Messaging__RabbitMQ__AutoProvision=true
Messaging__RabbitMQ__Durable=true
Messaging__RabbitMQ__UseQuorumQueues=false
Messaging__RabbitMQ__AutoPurgeOnStartup=false

# =====================================================
# INFRASTRUCTURE - Observability Stack
# =====================================================
# Grafana, Prometheus, Loki, Tempo, OTEL Collector
# Free local observability (replaces Azure Application Insights)

GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_PORT=3000

PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION=15d

LOKI_PORT=3100
TEMPO_PORT=3200

OTEL_COLLECTOR_PORT=4317
OTEL_COLLECTOR_HTTP_PORT=4318

# =====================================================
# .NET APPLICATION - Database Configuration
# =====================================================
# Maps to appsettings.json:
# {
#   "Database": {
#     "Postgres": {
#       "Host": "...",
#       "Port": 5432,
#       ...
#     }
#   }
# }

Database__Postgres__Host=postgres
Database__Postgres__Port=5432
Database__Postgres__Database=tc-agro-identity-db
Database__Postgres__UserName=postgres
Database__Postgres__Password=postgres
Database__Postgres__Schema=public
Database__Postgres__MaintenanceDatabase=postgres
Database__Postgres__ConnectionTimeout=30
Database__Postgres__MinPoolSize=2
Database__Postgres__MaxPoolSize=20

# =====================================================
# .NET APPLICATION - Cache Configuration
# =====================================================
# Maps to "Cache" > "Redis" in appsettings.json

Cache__Redis__Host=redis
Cache__Redis__Port=6379
Cache__Redis__Password=
Cache__Redis__DefaultTTL=300

# =====================================================
# .NET APPLICATION - Messaging Configuration
# =====================================================
# Maps to "Messaging" > "RabbitMQ" in appsettings.json

Messaging__RabbitMQ__Host=rabbitmq
Messaging__RabbitMQ__Port=5672
Messaging__RabbitMQ__ManagementPort=15672
Messaging__RabbitMQ__VirtualHost=/
Messaging__RabbitMQ__Exchange=identity.events
Messaging__RabbitMQ__UserName=guest
Messaging__RabbitMQ__Password=guest
Messaging__RabbitMQ__AutoProvision=true
Messaging__RabbitMQ__Durable=true
Messaging__RabbitMQ__UseQuorumQueues=false
Messaging__RabbitMQ__AutoPurgeOnStartup=false

# =====================================================
# .NET APPLICATION - Service Ports
# =====================================================
# Maps to "Services" > "{ServiceName}" > "HttpPort" in appsettings.json
# Used for service-to-service HTTP communication

Services__Identity__HttpPort=5001
Services__Farm__HttpPort=5002
Services__SensorIngest__HttpPort=5003
Services__AnalyticsWorker__HttpPort=5004
Services__Dashboard__HttpPort=5005

# =====================================================
# .NET APPLICATION - JWT / Authentication
# =====================================================
# Maps to "Auth" > "Jwt" in appsettings.json
# 
# ‚ö†Ô∏è IMPORTANT: SecretKey must be:
#    - At least 256 bits (32 bytes)
#    - Unique per environment
#    - CHANGED IN PRODUCTION
#    - Stored securely (Azure Key Vault in prod)

Auth__Jwt__Issuer=http://localhost:5001
Auth__Jwt__Audience=http://localhost:5000
Auth__Jwt__SecretKey=your-256-bit-secret-key-change-in-production-12345678901234567890
Auth__Jwt__ExpirationInMinutes=480

# ‚ö†Ô∏è PRODUCTION VALUES (Change when deploying):
# Auth__Jwt__Issuer=https://agro.yourdomain.com
# Auth__Jwt__Audience=https://agro.yourdomain.com
# Auth__Jwt__SecretKey=<GENERATE NEW 256-BIT KEY AND STORE IN AZURE KEY VAULT>
# Auth__Jwt__ExpirationInMinutes=60

# =====================================================
# .NET APPLICATION - Logging Configuration
# =====================================================
# Maps to "Logging" > "LogLevel" in appsettings.json
# Levels: Trace < Debug < Information < Warning < Error < Critical

Logging__LogLevel__Default=Information
Logging__LogLevel__Microsoft_AspNetCore=Warning
Logging__LogLevel__System=Warning

# Development recommendation:
# Logging__LogLevel__Default=Debug

# =====================================================
# .NET APPLICATION - TELEMETRY (Telemetry.Grafana.*)
# =====================================================
# Hierarchy: Telemetry > Grafana > Agent/Otlp > Key
# Maps to "Telemetry" > "Grafana" in appsettings.json
# Sends traces to Grafana Agent via OTLP

# Simple vars (for Docker Compose readability)
TELEMETRY_GRAFANA_AGENT_HOST=localhost
TELEMETRY_GRAFANA_AGENT_OTLP_GRPC_PORT=4317
TELEMETRY_GRAFANA_AGENT_OTLP_HTTP_PORT=4318
TELEMETRY_GRAFANA_AGENT_METRICS_PORT=12345
TELEMETRY_GRAFANA_AGENT_ENABLED=false
TELEMETRY_GRAFANA_OTLP_ENDPOINT=http://localhost:4317
TELEMETRY_GRAFANA_OTLP_PROTOCOL=grpc
TELEMETRY_GRAFANA_OTLP_TIMEOUT_SECONDS=10
TELEMETRY_GRAFANA_OTLP_INSECURE=true

# Hierarchical vars (for .NET IOptions binding)
Telemetry__Grafana__Agent__Host=${TELEMETRY_GRAFANA_AGENT_HOST}
Telemetry__Grafana__Agent__OtlpGrpcPort=${TELEMETRY_GRAFANA_AGENT_OTLP_GRPC_PORT}
Telemetry__Grafana__Agent__OtlpHttpPort=${TELEMETRY_GRAFANA_AGENT_OTLP_HTTP_PORT}
Telemetry__Grafana__Agent__MetricsPort=${TELEMETRY_GRAFANA_AGENT_METRICS_PORT}
Telemetry__Grafana__Agent__Enabled=${TELEMETRY_GRAFANA_AGENT_ENABLED}
Telemetry__Grafana__Otlp__Endpoint=${TELEMETRY_GRAFANA_OTLP_ENDPOINT}
Telemetry__Grafana__Otlp__Protocol=${TELEMETRY_GRAFANA_OTLP_PROTOCOL}
Telemetry__Grafana__Otlp__TimeoutSeconds=${TELEMETRY_GRAFANA_OTLP_TIMEOUT_SECONDS}
Telemetry__Grafana__Otlp__Insecure=${TELEMETRY_GRAFANA_OTLP_INSECURE}

# Production values:
# TELEMETRY_GRAFANA_AGENT_HOST=your-grafana-agent.azurecontainers.io
# TELEMETRY_GRAFANA_OTLP_ENDPOINT=https://your-grafana-agent.azurecontainers.io:4317
# TELEMETRY_GRAFANA_OTLP_INSECURE=false
# TELEMETRY_GRAFANA_AGENT_ENABLED=true

# =====================================================
# OPTIONAL - Advanced Configuration
# =====================================================
# Uncomment and modify for advanced scenarios

# Database SSL/TLS (production only)
# POSTGRES_SSL_MODE=require

# Custom logging provider
# LOGGING_PROVIDER=console|serilog|applicationinsights

# Feature flags (for A/B testing)
# FEATURE__ALERTS_ENABLED=true
# FEATURE__TIMESERIES_COMPRESSION=true

# =====================================================
# NOTES FOR DEVELOPERS
# =====================================================
# 
# 1. NEVER commit this file with sensitive data
#    - .env is in .gitignore
#    - Each developer has their own copy
#
# 2. Local development defaults are INSECURE:
#    - Default passwords (guest/guest, postgres/postgres)
#    - No SSL/TLS
#    - Public JWT secrets
#    - These are ONLY for localhost development
#
# 3. For production deployment:
#    - Use Azure Key Vault for secrets
#    - Enable SSL/TLS
#    - Generate unique JWT key
#    - Set strong passwords
#    - Use Application Insights instead of local OTEL
#
# 4. Connection troubleshooting:
#    - Verify all services running: docker compose ps
#    - Test PostgreSQL: docker exec tc-agro-postgres psql -U postgres
#    - Test Redis: docker exec tc-agro-redis redis-cli ping
#    - Test RabbitMQ: curl http://localhost:15672/api/overview
#
# 5. Variable format reference:
#    - Simple value: VARIABLE_NAME=value
#    - Connection strings: Host=...;Port=...;Username=...
#    - Hierarchical (.NET): Section__SubSection__Key=value
#    - Boolean: true/false (case-insensitive)
#    - Numeric: no quotes (5432, 256, etc.)
#    - Strings: no quotes needed unless containing spaces
#
# =====================================================
